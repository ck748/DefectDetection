{"ast":null,"code":"export default {\n  data() {\n    return {\n      // 获取1vh对应的像素值\n      vhInPixels: window.innerHeight * 0.01,\n      isUploaded: false,\n      // 记录上传状态\n      imageUrl: '',\n      // 用来存放上传后的图片地址\n      backendImageUrl: '',\n      // 用来存放后端传输过来的图片地址\n      imageContainerStyle: {\n        width: '600px',\n        height: '600px'\n      },\n      image1: null,\n      imagebase64: null,\n      loading: {\n        listloading: false\n      },\n      formData1: null,\n      tableData: [{\n        number: null,\n        score: null,\n        categoryId: null,\n        bbox: [],\n        category: null\n      }]\n    };\n  },\n  methods: {\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      // 使用 FileReader 读取图片\n      const reader = new FileReader();\n      reader.readAsDataURL(file); //转化成base64    url     返回dataurl很明显\n      this.image1 = file;\n      reader.onload = e => {\n        const imageSrc = reader.result; //返回文件的内容。只有在读取操作完成后，此属性才有效，返回的数据的格式取决于是使用哪种读取方法来执行读取操作的。\n        this.imagebase64 = e.target.result;\n        // 创建新的图片对象\n        const image = new Image();\n        image.src = imageSrc;\n        // 异步加载图片完成后进行大小设置和绘制\n        image.onload = () => {\n          const canvas = document.createElement('canvas'); //html5的canvas，document即dom对象的canvas创建方法，（html和js的一个交互接口）\n          canvas.width = 600;\n          canvas.height = 600;\n          const ctx = canvas.getContext('2d');\n\n          // 设置背景颜色为白色\n          ctx.fillStyle = \"#ffffff\"; // 白色\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n          // 等比例绘制图片（限制宽度）\n          const ratio = canvas.width / image.width;\n          const width = image.width * ratio;\n          const height = image.height * ratio;\n          const x = 0;\n          const y = (canvas.height - height) / 2;\n          ctx.drawImage(image, x, y, width, height);\n\n          // 导出图片\n          const newImageSrc = canvas.toDataURL('image/jpeg', 0.8); //图片质量0.8，较高\n          this.imageUrl = newImageSrc;\n          this.isUploaded = true; // 设置上传状态为已上传\n          // 重置 input 的值，以便下一次选择同名文件可以触发 change 事件\n          event.target.value = '';\n        };\n      };\n    },\n    Test() {\n      this.fetchBackendImage();\n      this.loading.listloading = true;\n    },\n    fetchBackendImage() {\n      const formData = new FormData();\n      formData.append('image', this.image1);\n      fetch('http://192.168.17.222:8080/detect', {\n        //\n        method: 'POST',\n        body: formData\n      }).then(response => {\n        if (response.code === 200) {\n          console.log(\"已经接到图片\");\n          this.$message({\n            type: \"success\",\n            message: \"检测完成\"\n          });\n          this.loading.listloading = false;\n          return response.json(); // 获取 JSON 格式的响应数据\n        } else {\n          throw new Error('未能获取后端图片');\n        }\n      }).then(responseData => {\n        console.log(responseData);\n        this.displayBase64Image(responseData.data.imgBase64);\n        this.tableData = responseData.data.defections;\n        this.tableData.forEach((item, index) => {\n          item.number = index + 1;\n        });\n        console.log(\"数字：\" + this.tableData.number);\n      }).catch(error => {\n        console.error('未能获取后端图片', error);\n      });\n    },\n    displayBase64Image(base64String) {\n      console.log(\"nihao\" + base64String);\n      this.backendImageUrl = `data:image/jpeg;base64, ${base64String}`;\n      console.log(this.backendImageUrl);\n      // 获取图片容器元素\n      const imageContainer = document.querySelector('.backend-image');\n      // 创建新的图片对象\n      const image = new Image();\n      image.src = this.backendImageUrl;\n      console.log(this.backendImageUrl);\n      // 异步加载图片\n      image.onload = () => {\n        const canvas = document.createElement('canvas');\n        canvas.width = image.width;\n        canvas.height = image.height;\n        const ctx = canvas.getContext('2d');\n        canvas.width = 600;\n        canvas.height = 600;\n        // 设置背景颜色为白色\n        ctx.fillStyle = \"#ffffff\"; // 白色\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        // 绘制图片\n        const ratio = canvas.width / image.width;\n        const width = image.width * ratio;\n        const height = image.height * ratio;\n        const x = 0;\n        const y = (canvas.height - height) / 2;\n        ctx.drawImage(image, x, y, width, height);\n\n        // 将绘制结果赋值给图片容器作为背景图\n        imageContainer.style.backgroundImage = `url(${canvas.toDataURL('image/jpeg', 0.8)})`;\n      };\n    }\n  }\n};","map":{"version":3,"names":["data","vhInPixels","window","innerHeight","isUploaded","imageUrl","backendImageUrl","imageContainerStyle","width","height","image1","imagebase64","loading","listloading","formData1","tableData","number","score","categoryId","bbox","category","methods","handleFileChange","event","file","target","files","reader","FileReader","readAsDataURL","onload","e","imageSrc","result","image","Image","src","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","ratio","x","y","drawImage","newImageSrc","toDataURL","value","Test","fetchBackendImage","formData","FormData","append","fetch","method","body","then","response","code","console","log","$message","type","message","json","Error","responseData","displayBase64Image","imgBase64","defections","forEach","item","index","catch","error","base64String","imageContainer","querySelector","style","backgroundImage"],"sources":["src/components/picture_detection.vue"],"sourcesContent":["<template>\n  <div>\n  <div class=\"container\">\n    <label class=\"upload-container\">\n      <input type=\"file\" @change=\"handleFileChange\" accept=\"image/*\" />\n      <div class=\"upload-icon\" v-if=\"!isUploaded\">\n        <i class=\"fas fa-plus\"></i>\n      </div>\n      <span class=\"icon iconfont\" style=\"position:relative;top: 300px ;margin-left: 35px\" v-if=\"!isUploaded\">&#xf0175;</span>\n      <div class=\"image-container\" :style=\"{ backgroundImage: 'url(' + imageUrl + ')' }\"></div>\n    </label>\n\n    <el-button type=\"primary\" :loading=\"loading.listloading\" @click=\"Test\" style=\"height:80px;position:relative;top:30vh;margin-left: 20px\" round>进行检测</el-button>\n    <label class=\"show-container\" style=\"top: 15px;margin-left: 20px\">\n      <div class=\"backend-image\" :style=\"{ backgroundImage: 'url(' + backendImageUrl + ')' }\"></div>\n    </label>\n  </div>\n  <div>\n    <el-table\n        :data=\"tableData\"\n        style=\"width: 100%;position: relative;top:5vh\">\n      <el-table-column\n          prop=\"number\"\n          label=\"序号\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"score\"\n          label=\"分数\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"categoryId\"\n          label=\"类别编号\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"bbox[0]\"\n          label=\"左上点x\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"bbox[1]\"\n          label=\"左上点y\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"bbox[2]\"\n          label=\"宽度\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"bbox[3]\"\n          label=\"高度\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"category\"\n          label=\"类别\"\n          width=\"180\">\n      </el-table-column>\n    </el-table>\n  </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      // 获取1vh对应的像素值\n      vhInPixels: window.innerHeight * 0.01,\n      isUploaded: false, // 记录上传状态\n      imageUrl: '', // 用来存放上传后的图片地址\n      backendImageUrl: '', // 用来存放后端传输过来的图片地址\n      imageContainerStyle: {\n        width: '600px',\n        height: '600px'\n      },\n      image1:null,\n      imagebase64:null,\n      loading:{\n        listloading:false\n      },\n      formData1:null,\n      tableData: [\n        {\n          number: null,\n          score: null,\n          categoryId: null,\n          bbox:[],\n          category: null\n        }\n      ]\n    };\n  },\n  methods: {\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      // 使用 FileReader 读取图片\n      const reader = new FileReader();\n      reader.readAsDataURL(file);             //转化成base64    url     返回dataurl很明显\n      this.image1=file;\n      reader.onload = ( e ) => {\n        const imageSrc = reader.result;         //返回文件的内容。只有在读取操作完成后，此属性才有效，返回的数据的格式取决于是使用哪种读取方法来执行读取操作的。\n        this.imagebase64=e.target.result;\n        // 创建新的图片对象\n        const image = new Image();\n        image.src = imageSrc;\n        // 异步加载图片完成后进行大小设置和绘制\n        image.onload = () => {\n          const canvas = document.createElement('canvas');     //html5的canvas，document即dom对象的canvas创建方法，（html和js的一个交互接口）\n          canvas.width = 600;\n          canvas.height = 600;\n          const ctx = canvas.getContext('2d');\n\n          // 设置背景颜色为白色\n          ctx.fillStyle = \"#ffffff\"; // 白色\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n          // 等比例绘制图片（限制宽度）\n          const ratio = canvas.width / image.width;\n          const width = image.width * ratio;\n          const height = image.height * ratio;\n          const x = 0;\n          const y = (canvas.height - height) / 2;\n          ctx.drawImage(image, x, y, width, height);\n\n          // 导出图片\n          const newImageSrc = canvas.toDataURL('image/jpeg', 0.8);//图片质量0.8，较高\n          this.imageUrl = newImageSrc;\n          this.isUploaded = true; // 设置上传状态为已上传\n          // 重置 input 的值，以便下一次选择同名文件可以触发 change 事件\n          event.target.value = '';\n        };\n      };\n\n    },\n    Test() {\n      this.fetchBackendImage()\n      this.loading.listloading = true\n    },\n    fetchBackendImage() {\n      const formData = new FormData();\n      formData.append('image', this.image1);\n\n      fetch('http://192.168.17.222:8080/detect', {         //\n        method: 'POST',\n        body: formData,\n      })\n          .then((response) => {\n            if (response.code === 200) {\n              console.log(\"已经接到图片\");\n              this.$message({\n                type:\"success\",\n                message: \"检测完成\"\n              });\n              this.loading.listloading = false;\n              return response.json(); // 获取 JSON 格式的响应数据\n            } else {\n              throw new Error('未能获取后端图片');\n            }\n          })\n          .then((responseData) => {\n            console.log(responseData);\n            this.displayBase64Image(responseData.data.imgBase64);\n            this.tableData=responseData.data.defections;\n            this.tableData.forEach((item, index) => {\n              item.number = index + 1;\n            });\n            console.log(\"数字：\"+this.tableData.number);\n          })\n          .catch((error) => {\n            console.error('未能获取后端图片', error);\n          });\n    },\n    displayBase64Image(base64String) {\n      console.log(\"nihao\"+base64String)\n      this.backendImageUrl = `data:image/jpeg;base64, ${base64String}`;\n      console.log(this.backendImageUrl)\n      // 获取图片容器元素\n      const imageContainer = document.querySelector('.backend-image');\n      // 创建新的图片对象\n      const image = new Image();\n      image.src = this.backendImageUrl;\n      console.log(this.backendImageUrl)\n      // 异步加载图片\n      image.onload = () => {\n        const canvas = document.createElement('canvas');\n        canvas.width = image.width;\n        canvas.height = image.height;\n        const ctx = canvas.getContext('2d');\n        canvas.width = 600;\n        canvas.height = 600;\n        // 设置背景颜色为白色\n        ctx.fillStyle = \"#ffffff\"; // 白色\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        // 绘制图片\n        const ratio = canvas.width / image.width;\n        const width = image.width * ratio;\n        const height = image.height * ratio;\n        const x = 0;\n        const y = (canvas.height - height) / 2;\n        ctx.drawImage(image, x, y, width, height);\n\n\n\n        // 将绘制结果赋值给图片容器作为背景图\n        imageContainer.style.backgroundImage = `url(${canvas.toDataURL('image/jpeg', 0.8)})`;\n      };\n    }\n  },\n};\n</script>\n\n<style>\n\n.container {\n  display: flex;\n}\n\n.upload-container {\n  position: relative;\n  display: inline-block;\n}\n\n.show-container {\n  position: relative;\n  display: inline-block;\n}\n\n.upload-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 60px;\n  height: 60px;\n  border: 2px dashed #ccc;\n  border-radius: 50%;\n  text-align: center;\n  cursor: pointer;\n}\n\n.upload-icon i {\n  font-size: 30px;\n  line-height: 60px;\n  color: #666;\n}\n\n.image-container {\n  width: 550px;\n  height: 550px;\n  border: 2px dashed #ccc;\n  padding: 20px;\n  text-align: center;\n  background-color: white;\n}\n\n.image-container p {\n  margin-top: 50%;\n  transform: translateY(-50%);\n}\n\n.backend-image {\n  width: 600px;\n  height: 600px;\n  border: 2px dashed #ccc;\n  background-size: cover;\n  background-position: center;\n}\n.iconfont{\n  color: #0086b3;\n}\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}