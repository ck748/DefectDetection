{"ast":null,"code":"import axios from 'axios';\nimport moment from \"moment/moment\";\nexport default {\n  data() {\n    return {\n      searchName: '',\n      tableData: [],\n      page: 1,\n      pageSize: 10,\n      total: 0,\n      dateRange: [],\n      dateL: '',\n      dateR: '',\n      loading: false,\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick(picker) {\n            const end = moment().endOf('day');\n            const start = moment(end).subtract(1, 'week').startOf('day');\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一月',\n          onClick(picker) {\n            const end = moment().endOf('day');\n            const start = moment(end).subtract(1, 'month').startOf('day');\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一年',\n          onClick(picker) {\n            const end = moment().endOf('day');\n            const start = moment(end).subtract(1, 'year').startOf('day');\n            picker.$emit('pick', [start, end]);\n          }\n        }],\n        disabledDate(time) {\n          return time.getTime() > Date.now(); // 禁止选择未来日期\n        }\n      }\n    };\n  },\n  created() {\n    this.fetchData();\n  },\n  computed: {\n    filteredtableData() {\n      if (!this.searchName) {\n        return this.tableData;\n      } else {\n        const searchName = this.searchName.toLowerCase();\n        return this.tableData.filter(log => {\n          return log.mainRole.toLowerCase().includes(searchName) || log.label.toLowerCase().includes(searchName);\n        });\n      }\n    }\n  },\n  methods: {\n    search() {\n      this.searchName = this.searchName.trim();\n    },\n    mainTime() {\n      console.log(\"这里是时间段哦\", this.dateRange);\n      if (this.dateRange && this.dateRange.length === 2) {\n        let startTime = new Date(this.dateRange[0]); // 将开始时间字符串转换为日期对象\n        let endTime = new Date(this.dateRange[1]); // 将结束时间字符串转换为日期对象\n        startTime.setHours(23, 59, 59, 999); // 将开始时间设置为当天的23:59:59\n        endTime.setHours(23, 59, 59, 999); // 将结束时间设置为当天的23:59:59\n        this.dateL = startTime.getTime(); // 获取开始时间的时间戳\n        this.dateR = endTime.getTime(); // 获取结束时间的时间戳\n        console.log(\"开始时间的时间戳：\", this.dateL);\n        console.log(\"结束时间的时间戳：\", this.dateR);\n        this.fetchData();\n      } else {\n        this.$message.warning('请选择完整的时间范围');\n      }\n    },\n    fetchData() {\n      this.loading = true;\n      axios.get('api/log/info', {\n        params: {\n          page: this.page,\n          pageSize: this.pageSize,\n          dateL: this.dateL,\n          dateR: this.dateR\n        }\n      }) // 发起 GET 请求获取数据\n      .then(response => {\n        this.loading = false;\n        if (response.data.code === 200) {\n          this.tableData = response.data.data; // 将获取的数据填充到tableData中\n          console.log(\"22222222222\", response.data.data);\n          this.total = this.tableData[0].totals;\n          console.log(\"1111111111111111111\", this.total);\n          this.$message({\n            message: '查询到日志信息',\n            type: 'success'\n          });\n        } else {\n          this.$message.error(\"日志信息获取失败\");\n        }\n      }).catch(error => {\n        this.loading = false;\n        console.error('获取数据失败', error);\n        this.$message({\n          message: '未能查询到日志信息',\n          type: 'error'\n        });\n      });\n    },\n    handleSizeChange(val) {\n      this.pageSize = val;\n      this.fetchData();\n    },\n    handleCurrentChange(val) {\n      this.page = val;\n      this.fetchData();\n    }\n  }\n};","map":{"version":3,"names":["axios","moment","data","searchName","tableData","page","pageSize","total","dateRange","dateL","dateR","loading","pickerOptions","shortcuts","text","onClick","picker","end","endOf","start","subtract","startOf","$emit","disabledDate","time","getTime","Date","now","created","fetchData","computed","filteredtableData","toLowerCase","filter","log","mainRole","includes","label","methods","search","trim","mainTime","console","length","startTime","endTime","setHours","$message","warning","get","params","then","response","code","totals","message","type","error","catch","handleSizeChange","val","handleCurrentChange"],"sources":["src/components/log.vue"],"sourcesContent":["<template>\n  <div class=\"log-container\">\n    <!-- 顶部筛选区域 -->\n    <div class=\"filter-section\">\n      <div class=\"filter-group\">\n        <span class=\"filter-label\">时间段:</span>\n        <div class=\"date-picker-group\">\n          <el-date-picker\n            v-model=\"dateRange\"\n            type=\"daterange\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            :picker-options=\"pickerOptions\"\n            class=\"date-picker\"\n          ></el-date-picker>\n          <el-button type=\"primary\" class=\"confirm-btn\" @click=\"mainTime\">确认时间段</el-button>\n        </div>\n      </div>\n      \n      <div class=\"search-group\">\n        <el-input \n          v-model=\"searchName\" \n          placeholder=\"搜索主体或工号\" \n          class=\"search-input\" \n          prefix-icon=\"el-icon-search\" \n          @input=\"search\"\n          clearable\n        ></el-input>\n      </div>\n    </div>\n    \n    <!-- 表格区域 -->\n    <div class=\"table-section\">\n      <el-card class=\"table-card\">\n        <el-table \n        :data=\"filteredtableData\" \n        style=\"width: 100%\"\n        stripe\n        v-loading=\"loading\"\n        element-loading-text=\"数据加载中...\"\n        element-loading-spinner=\"el-icon-loading\"\n>\n        <el-table-column type=\"index\" label=\"编号\" width=\"100\" align=\"center\" header-align=\"center\"></el-table-column>\n        <el-table-column prop=\"mainRole\" label=\"主体\" min-width=\"120\" align=\"center\" header-align=\"center\"></el-table-column>\n        <el-table-column prop=\"label\" label=\"工号或账号\" min-width=\"150\" align=\"center\" header-align=\"center\"></el-table-column>\n        <el-table-column prop=\"op\" label=\"操作\" min-width=\"180\" align=\"center\" header-align=\"center\"></el-table-column>\n        <el-table-column prop=\"time\" label=\"时间\" min-width=\"160\" align=\"center\" header-align=\"center\"></el-table-column>\n</el-table>\n        \n        <!-- 分页 -->\n        <div class=\"pagination-container\">\n          <el-pagination\n            @size-change=\"handleSizeChange\"\n            @current-change=\"handleCurrentChange\"\n            :current-page=\"page\"\n            :page-sizes=\"[10, 20, 30, 50]\"\n            :page-size=\"pageSize\"\n            layout=\"total, sizes, prev, pager, next, jumper\"\n            :total=\"total\"\n            background\n          >\n          </el-pagination>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport moment from \"moment/moment\";\n\nexport default {\n  data() {\n    return {\n      searchName: '',\n      tableData: [],\n      page: 1,\n      pageSize: 10,\n      total: 0,\n      dateRange: [],\n      dateL: '',\n      dateR: '',\n      loading: false,\n      pickerOptions: {\n        shortcuts: [\n          {\n            text: '最近一周',\n            onClick(picker) {\n              const end = moment().endOf('day');\n              const start = moment(end).subtract(1, 'week').startOf('day');\n              picker.$emit('pick', [start, end]);\n            }\n          },\n          {\n            text: '最近一月',\n            onClick(picker) {\n              const end = moment().endOf('day');\n              const start = moment(end).subtract(1, 'month').startOf('day');\n              picker.$emit('pick', [start, end]);\n            }\n          },\n          {\n            text: '最近一年',\n            onClick(picker) {\n              const end = moment().endOf('day');\n              const start = moment(end).subtract(1, 'year').startOf('day');\n              picker.$emit('pick', [start, end]);\n            }\n          }\n        ],\n        disabledDate(time) {\n          return time.getTime() > Date.now(); // 禁止选择未来日期\n        }\n      },\n    };\n  },\n  created() {\n    this.fetchData();\n  },\n  computed: {\n    filteredtableData() {\n      if (!this.searchName) {\n        return this.tableData;\n      } else {\n        const searchName = this.searchName.toLowerCase();\n        return this.tableData.filter(log => {\n          return (\n            log.mainRole.toLowerCase().includes(searchName) ||\n            log.label.toLowerCase().includes(searchName)\n          );\n        });\n      }\n    }\n  },\n  methods: {\n    search() {\n      this.searchName = this.searchName.trim();\n    },\n    mainTime() {\n      console.log(\"这里是时间段哦\", this.dateRange);\n      if (this.dateRange && this.dateRange.length === 2) {\n        let startTime = new Date(this.dateRange[0]); // 将开始时间字符串转换为日期对象\n        let endTime = new Date(this.dateRange[1]); // 将结束时间字符串转换为日期对象\n        startTime.setHours(23, 59, 59, 999); // 将开始时间设置为当天的23:59:59\n        endTime.setHours(23, 59, 59, 999); // 将结束时间设置为当天的23:59:59\n        this.dateL = startTime.getTime(); // 获取开始时间的时间戳\n        this.dateR = endTime.getTime(); // 获取结束时间的时间戳\n        console.log(\"开始时间的时间戳：\", this.dateL);\n        console.log(\"结束时间的时间戳：\", this.dateR);\n        this.fetchData();\n      } else {\n        this.$message.warning('请选择完整的时间范围');\n      }\n    },\n    fetchData() {\n      this.loading = true;\n      axios.get('api/log/info', {\n        params: {\n          page: this.page,\n          pageSize: this.pageSize,\n          dateL: this.dateL,\n          dateR: this.dateR\n        }\n      })  // 发起 GET 请求获取数据\n        .then(response => {\n          this.loading = false;\n          if (response.data.code === 200) {\n            this.tableData = response.data.data;  // 将获取的数据填充到tableData中\n            console.log(\"22222222222\", response.data.data)\n            this.total = this.tableData[0].totals;\n            console.log(\"1111111111111111111\", this.total)\n            this.$message({\n              message: '查询到日志信息',\n              type: 'success'\n            });\n          } else {\n            this.$message.error(\"日志信息获取失败\")\n          }\n        })\n        .catch(error => {\n          this.loading = false;\n          console.error('获取数据失败', error);\n          this.$message({\n            message: '未能查询到日志信息',\n            type: 'error'\n          });\n        });\n    },\n    handleSizeChange(val) {\n      this.pageSize = val;\n      this.fetchData();\n    },\n    handleCurrentChange(val) {\n      this.page = val;\n      this.fetchData();\n    }\n  }\n}\n</script>\n\n<style scoped>\n.log-container {\n  padding: 20px;\n  background-color: #f5f7fa;\n  min-height: calc(100vh - 60px);\n}\n\n.filter-section {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n  background: white;\n  padding: 16px 20px;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n}\n\n.filter-group {\n  display: flex;\n  align-items: center;\n}\n\n.filter-label {\n  font-weight: 500;\n  color: #606266;\n  margin-right: 12px;\n  font-size: 14px;\n}\n\n.date-picker-group {\n  display: flex;\n  align-items: center;\n}\n\n.date-picker {\n  width: 280px;\n  margin-right: 12px;\n}\n\n.confirm-btn {\n  height: 40px;\n  padding: 0 20px;\n}\n\n.search-group {\n  display: flex;\n}\n\n.search-input {\n  width: 240px;\n}\n\n.table-section {\n  margin-top: 16px;\n}\n\n.table-card {\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  border: none;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n}\n\n/* 表格样式优化 */\n.el-table {\n  font-size: 14px;\n}\n\n.el-table th {\n  background-color: #f8f9fa;\n  color: #606266;\n  font-weight: 600;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .filter-section {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  \n  .search-group {\n    margin-top: 16px;\n    width: 100%;\n  }\n  \n  .search-input {\n    width: 100%;\n  }\n  \n  .date-picker-group {\n    flex-direction: column;\n    width: 100%;\n  }\n  \n  .date-picker {\n    width: 100%;\n    margin-right: 0;\n    margin-bottom: 12px;\n  }\n  \n  .confirm-btn {\n    width: 100%;\n  }\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}