{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nexport default {\n  name: \"XXX\",\n  data() {\n    return {\n      visible: false,\n      //弹窗\n      loading: false,\n      //上传按钮加载\n      os: false,\n      //控制摄像头开关\n      thisVideo: null,\n      thisContext: null,\n      thisCancas: null,\n      videoWidth: 500,\n      videoHeight: 400,\n      postOptions: [],\n      CertCtl: '',\n      // 遮罩层\n      loading: true,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 总条数\n      total: 0,\n      // 项目人员表格数据\n      akworkerList: [],\n      //工种类别数据字典\n      workerTypeOptions: [],\n      // 弹出层标题\n      title: \"\",\n      // 是否显示弹出层\n      open: false,\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        imgSrc: undefined\n      },\n      // 表单参数\n      form: {},\n      // 表单校验\n      rules: {}\n    };\n  },\n  created() {},\n  methods: {\n    /*调用摄像头拍照开始*/\n    onTake() {\n      this.visible = true;\n      this.getCompetence();\n    },\n    onCancel() {\n      this.visible = false;\n      /* this.resetCanvas();*/\n      this.stopNavigator();\n    },\n    // 调用摄像头权限\n    getCompetence() {\n      //必须在model中render后才可获取到dom节点,直接获取无法获取到model中的dom节点\n      this.$nextTick(() => {\n        const _this = this;\n        this.os = false; //切换成关闭摄像头\n        this.thisCancas = document.getElementById('canvasCamera');\n        this.thisContext = this.thisCancas.getContext('2d');\n        this.thisVideo = document.getElementById('videoCamera');\n        // 旧版本浏览器可能根本不支持mediaDevices，我们首先设置一个空对象\n        if (navigator.mediaDevices === undefined) {\n          navigator.menavigatordiaDevices = {};\n        }\n        // 一些浏览器实现了部分mediaDevices，我们不能只分配一个对象\n        // 使用getUserMedia，因为它会覆盖现有的属性。\n        // 这里，如果缺少getUserMedia属性，就添加它。\n        if (navigator.mediaDevices.getUserMedia === undefined) {\n          navigator.mediaDevices.getUserMedia = function (constraints) {\n            // 首先获取现存的getUserMedia(如果存在)\n            let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia;\n            // 有些浏览器不支持，会返回错误信息\n            // 保持接口一致\n            if (!getUserMedia) {\n              return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n            }\n            // 否则，使用Promise将调用包装到旧的navigator.getUserMedia\n            return new Promise(function (resolve, reject) {\n              getUserMedia.call(navigator, constraints, resolve, reject);\n            });\n          };\n        }\n        const constraints = {\n          audio: false,\n          video: {\n            width: _this.videoWidth,\n            height: _this.videoHeight,\n            transform: 'scaleX(-1)'\n          }\n        };\n        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n          // 旧的浏览器可能没有srcObject\n          if ('srcObject' in _this.thisVideo) {\n            _this.thisVideo.srcObject = stream;\n          } else {\n            // 避免在新的浏览器中使用它，因为它正在被弃用。\n            _this.thisVideo.src = window.URL.createObjectURL(stream);\n          }\n          _this.thisVideo.onloadedmetadata = function (e) {\n            _this.thisVideo.play();\n          };\n        }).catch(err => {\n          this.$notify({\n            title: '警告',\n            message: '没有开启摄像头权限或浏览器版本不兼容.',\n            type: 'warning'\n          });\n        });\n      });\n    },\n    //绘制图片\n    drawImage() {\n      // 点击，canvas画图\n      this.thisContext.drawImage(this.thisVideo, 0, 0, this.videoWidth, this.videoHeight);\n      // 获取图片base64链接\n      this.imgSrc = this.thisCancas.toDataURL('image/png');\n      /*const imgSrc=this.imgSrc;*/\n    },\n    //清空画布\n    clearCanvas(id) {\n      let c = document.getElementById(id);\n      let cxt = c.getContext(\"2d\");\n      cxt.clearRect(0, 0, c.width, c.height);\n    },\n    //重置画布\n    resetCanvas() {\n      this.imgSrc = \"\";\n      this.clearCanvas('canvasCamera');\n    },\n    //关闭摄像头\n    stopNavigator() {\n      if (this.thisVideo && this.thisVideo !== null) {\n        this.thisVideo.srcObject.getTracks()[0].stop();\n        this.os = true; //切换成打开摄像头\n      }\n    }\n    /*调用摄像头拍照结束*/\n  }\n};","map":{"version":3,"names":["name","data","visible","loading","os","thisVideo","thisContext","thisCancas","videoWidth","videoHeight","postOptions","CertCtl","ids","single","multiple","total","akworkerList","workerTypeOptions","title","open","queryParams","pageNum","pageSize","imgSrc","undefined","form","rules","created","methods","onTake","getCompetence","onCancel","stopNavigator","$nextTick","_this","document","getElementById","getContext","navigator","mediaDevices","menavigatordiaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","Promise","reject","Error","resolve","call","audio","video","width","height","transform","then","stream","srcObject","src","window","URL","createObjectURL","onloadedmetadata","e","play","catch","err","$notify","message","type","drawImage","toDataURL","clearCanvas","id","c","cxt","clearRect","resetCanvas","getTracks","stop"],"sources":["src/components/camera.vue"],"sourcesContent":["<template>\n  <div>\n    <!--<el-input type=\"text\" v-model=\"imgSrc\" />-->\n    <el-col :span=\"1.5\">\n      <el-button\n          @click=\"onTake\"\n          icon=\"el-icon-camera\"\n          size=\"small\">\n        打卡签到\n      </el-button>\n    </el-col>\n    <!--拍照后显示图片-->\n    <!--<el-form-item label=\"\" prop=\"imgSrc\">\n      <img v-if=\"imgSrc\"  :src=\"imgSrc\" style=\"width: 200px;height: 240px;\" />\n    </el-form-item>-->\n    <!--拍照模态框-->\n    <el-dialog\n        title=\"拍照上传\"\n        :visible.sync=\"visible\"\n        @close=\"onCancel\"\n        width=\"1065px\">\n      <div class=\"box\">\n        <video id=\"videoCamera\" class=\"canvas\" :width=\"videoWidth\" :height=\"videoHeight\" autoPlay></video>\n        <canvas id=\"canvasCamera\" class=\"canvas\" :width=\"videoWidth\" :height=\"videoHeight\"></canvas>\n      </div>\n      <div slot=\"footer\">\n        <el-button\n            @click=\"drawImage\"\n            icon=\"el-icon-camera\"\n            size=\"small\">\n          拍照\n        </el-button>\n        <el-button\n            v-if=\"os\"\n            @click=\"getCompetence\"\n            icon=\"el-icon-video-camera\"\n            size=\"small\">\n          打开摄像头\n        </el-button>\n        <el-button\n            v-else\n            @click=\"stopNavigator\"\n            icon=\"el-icon-switch-button\"\n            size=\"small\">\n          关闭摄像头\n        </el-button>\n        <el-button\n            @click=\"resetCanvas\"\n            icon=\"el-icon-refresh\"\n            size=\"small\">\n          重置\n        </el-button>\n        <el-button\n            @click=\"onCancel\"\n            icon=\"el-icon-circle-close\"\n            size=\"small\">\n          完成\n        </el-button>\n      </div>\n    </el-dialog>\n\n  </div>\n</template>\n<script>\nexport default {\n  name: \"XXX\",\n  data() {\n    return {\n      visible: false,//弹窗\n      loading: false,//上传按钮加载\n      os: false,//控制摄像头开关\n      thisVideo: null,\n      thisContext: null,\n      thisCancas: null,\n      videoWidth: 500,\n      videoHeight: 400,\n      postOptions:[],\n      CertCtl:'',\n      // 遮罩层\n      loading: true,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 总条数\n      total: 0,\n      // 项目人员表格数据\n      akworkerList: [],\n      //工种类别数据字典\n      workerTypeOptions:[],\n      // 弹出层标题\n      title: \"\",\n      // 是否显示弹出层\n      open: false,\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        imgSrc:undefined,\n      },\n      // 表单参数\n      form: {},\n      // 表单校验\n      rules: {\n      }\n    };\n  },\n  created() {\n\n  },\n  methods: {\n    /*调用摄像头拍照开始*/\n    onTake() {\n      this.visible = true;\n      this.getCompetence();\n    },\n    onCancel() {\n      this.visible = false;\n      /* this.resetCanvas();*/\n      this.stopNavigator();\n    },\n    // 调用摄像头权限\n    getCompetence() {\n      //必须在model中render后才可获取到dom节点,直接获取无法获取到model中的dom节点\n      this.$nextTick(() => {\n        const _this = this;\n        this.os = false;//切换成关闭摄像头\n        this.thisCancas = document.getElementById('canvasCamera');\n        this.thisContext = this.thisCancas.getContext('2d');\n        this.thisVideo = document.getElementById('videoCamera');\n        // 旧版本浏览器可能根本不支持mediaDevices，我们首先设置一个空对象\n        if (navigator.mediaDevices === undefined) {\n          navigator.menavigatordiaDevices = {}\n        }\n        // 一些浏览器实现了部分mediaDevices，我们不能只分配一个对象\n        // 使用getUserMedia，因为它会覆盖现有的属性。\n        // 这里，如果缺少getUserMedia属性，就添加它。\n        if (navigator.mediaDevices.getUserMedia === undefined) {\n          navigator.mediaDevices.getUserMedia = function (constraints) {\n            // 首先获取现存的getUserMedia(如果存在)\n            let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia;\n            // 有些浏览器不支持，会返回错误信息\n            // 保持接口一致\n            if (!getUserMedia) {\n              return Promise.reject(new Error('getUserMedia is not implemented in this browser'))\n            }\n            // 否则，使用Promise将调用包装到旧的navigator.getUserMedia\n            return new Promise(function (resolve, reject) {\n              getUserMedia.call(navigator, constraints, resolve, reject)\n            })\n          }\n        }\n        const constraints = {\n          audio: false,\n          video: {width: _this.videoWidth, height: _this.videoHeight, transform: 'scaleX(-1)'}\n        };\n        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n          // 旧的浏览器可能没有srcObject\n          if ('srcObject' in _this.thisVideo) {\n            _this.thisVideo.srcObject = stream\n          } else {\n            // 避免在新的浏览器中使用它，因为它正在被弃用。\n            _this.thisVideo.src = window.URL.createObjectURL(stream)\n          }\n          _this.thisVideo.onloadedmetadata = function (e) {\n            _this.thisVideo.play()\n          }\n        }).catch(err => {\n          this.$notify({\n            title: '警告',\n            message: '没有开启摄像头权限或浏览器版本不兼容.',\n            type: 'warning'\n          });\n        });\n      });\n    },\n    //绘制图片\n    drawImage() {\n      // 点击，canvas画图\n      this.thisContext.drawImage(this.thisVideo, 0, 0, this.videoWidth, this.videoHeight);\n      // 获取图片base64链接\n      this.imgSrc = this.thisCancas.toDataURL('image/png');\n      /*const imgSrc=this.imgSrc;*/\n    },\n    //清空画布\n    clearCanvas(id) {\n      let c = document.getElementById(id);\n      let cxt = c.getContext(\"2d\");\n      cxt.clearRect(0, 0, c.width, c.height);\n    },\n    //重置画布\n    resetCanvas() {\n      this.imgSrc = \"\";\n      this.clearCanvas('canvasCamera');\n    },\n    //关闭摄像头\n    stopNavigator() {\n      if (this.thisVideo && this.thisVideo !== null) {\n        this.thisVideo.srcObject.getTracks()[0].stop();\n        this.os = true;//切换成打开摄像头\n      }\n    },\n    /*调用摄像头拍照结束*/\n  }\n};\n</script>\n\n<style>\n</style>\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}